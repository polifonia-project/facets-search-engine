{% load i18n %}

<!--/////////////-->
<!-- VEROVIO -->
<!--/////////////-->  

<script src="/static/js/verovio-toolkit.js"></script>
<script>var vrvToolkit = new verovio.toolkit();</script>

<div>
    <ul class="toolbar">
    {% if score_info %}

        {% for i, v in score_info.items %}

        {% if v.0 == "mei" %}
        <li class="mei"><a target="_blank" href="{{v.1}}"
                           title="{% trans 'Download MEI' %}"> <span class="accessibility">{% trans 'Download MEI' %}</span>
        </a></li>
        {% endif  %}

        {% if v.0 == "musicxml" or v.0 == "xml"%}
        <li class="download"><a target="_blank" href="{{v.1}}"
                                title="{% trans 'Download MusicXML'%}" target="_blank"> <span class="accessibility">{% trans 'Download MusicXML' %}</span>
        </a></li>
        {% endif %}
 
    </ul>
        <a name="{{i}}" />
        {%comment%}
        <h5>
            <a href="{{i}} ">{{i}}</a>
        </h5>
        {%endcomment%}
    
        <script type="text/javascript">
        /* Load the file using HTTP GET */
        console.log ("Get url for {{i}}")
            var vrvOptions = {
            scale : 35,
            pageHeight : 100,
            adjustPageHeight : 1,
            border : 0,
            ignoreLayout : 1
        };

        vrvToolkit.setOptions(vrvOptions);

        document.addEventListener('DOMContentLoaded', (event) => {
            $.ajax({
                url: "{{v.1}}",
                dataType: "text",
                success: function(data) {
                    var svg = vrvToolkit.renderData(data);
                    document.getElementById("notation").innerHTML = svg;
                    $("#incipit{{i}}").html(svg);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log("Error with document {{i}} " + xhr.status);
                }
            });
        });
        </script>       
        {%comment%}
        <table class="preview"><tr>
            <td valign="top">
            </td><td>     <a href="home/dashboard/{{index_name}}/{{i}}'";><div id="incipit{{i}}"></div></a>
        </td>
        </tr>
        </table>
        {%endcomment%}

    {% endfor %}

    {% else %}
    <table class="preview"><tr>
        <td valign="top"> </td>
        <td>     <div id="notation">scores placeholder</div> </td>
    </tr>
    </table>
    {% endif %}

</div>

{% load i18n %}

<!--/////////////-->
<!-- VEROVIO -->
<!--/////////////-->  

<script src="/static/js/verovio-toolkit.js"></script>
<script>var vrvToolkit = new verovio.toolkit();</script>

<div width="400">

    {% if score_info %}

        {% for i, v in score_info.items %}

        <div class="bg-white p-3 rounded shadow" style="width: 800px;">
            {%comment%}
            {% if v.0 == "mei" %}
            <li class="mei"><a target="_blank" href="{{v.1}}"
                           title="{% trans 'Download MEI' %}"> <span class="accessibility">{% trans 'Download MEI' %}</span>
            </a></li>
            {% endif  %}

            {% if v.0 == "musicxml" or v.0 == "xml"%}
            <li class="download"><a target="_blank" href="{{v.1}}"
                                title="{% trans 'Download MusicXML'%}" target="_blank"> <span class="accessibility">{% trans 'Download MusicXML' %}</span>
            </a></li>
            {% endif %}
            {%endcomment%}


            <h6>
            Title: {{v.2}}
            </br>
            Composer: {{v.3}}
            </br>
            Click to see full score of the document: 
            <a href="/home/dashboard/{{index_name}}/{{i}}"> "{{i}}" </a>
            </h6>
            </br>
            <script type="text/javascript">
            /* Load the file using HTTP GET */
            console.log ("Get url for {{i}}")
                var vrvOptions = {
                scale : 35,
                pageHeight : 100,
                adjustPageHeight : 1,
                border : 0,
                ignoreLayout : 1
            };

            vrvToolkit.setOptions(vrvOptions);

            document.addEventListener('DOMContentLoaded', (event) => {
                $.ajax({
                    url: "{{v.1}}",
                    dataType: "text",
                    success: function(data) {
                        var svg = vrvToolkit.renderData(data);
                        document.getElementById("notation{{i}}").innerHTML = svg;
                        $("#incipit{{i}}").html(svg);
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log("Error with document {{i}} " + xhr.status);
                    }
                });
            });
            </script>       

            <div>
            <table class="preview"><tr>
            <td valign="10em"> </td>
            <td>     <div id="notation{{i}}">score placeholder</div> </td>
            </tr>
            </table>
            </div>


            {%comment%}
            <table class="preview"><tr>
                <td valign="middle">
                </td><td>     <a href="home/dashboard/{{index_name}}/{{i}}'";><div id="incipit{{i}}"></div></a>
            </td>
            </tr>
            </table>
            {%endcomment%}
            </div>
            <br/>
    {% endfor %}

    {% else %}
    <table class="preview"><tr>
        <td valign="top"> </td>
        <td>     <div id="notation">Please re-enter your search!</div> </td>
    </tr>
    </table>
    {% endif %}

</div>
